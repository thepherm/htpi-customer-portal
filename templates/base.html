<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}HTPI Customer Portal{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50">
    {% block content %}{% endblock %}
    
    <script>
        // Initialize Socket.IO connection to local server
        let socket = null;
        
        function initSocket() {
            if (socket && socket.connected) {
                return socket;
            }
            
            // Connect to same origin (local Flask-SocketIO server)
            socket = io({
                transports: ['websocket'],
                reconnection: true,
                reconnectionAttempts: 5,
                reconnectionDelay: 1000
            });
            
            // Connection event handlers
            socket.on('connect', () => {
                console.log('Connected to customer portal server');
            });
            
            socket.on('connected', (data) => {
                console.log('Server acknowledged:', data.message);
            });
            
            socket.on('disconnect', (reason) => {
                console.log('Disconnected from server:', reason);
            });
            
            socket.on('connect_error', (error) => {
                console.error('Connection error:', error.message);
            });
            
            socket.on('error', (data) => {
                console.error('Server error:', data.message);
                if (data.message === 'Not authenticated') {
                    window.location.href = '/login';
                }
            });
            
            return socket;
        }
        
        // Initialize connection on page load
        document.addEventListener('DOMContentLoaded', () => {
            initSocket();
        });
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>